name: Build AppImage

run-name: ${{ github.actor }} is testing out building appimage
on: [push,workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-22.04
    
    steps:
    - uses: actions/checkout@v2
    # - name: Install Qt
    #   uses: jurplel/install-qt-action@v4
    #   with:
    #     version: 6.8.3

    - name: list
      working-directory: ${{github.workspace}}
      run : ls
    
    - name: install python dependencies to project folder
      working-directory: ${{github.workspace}}
      run : python3 -m pip install --ignore-installed --prefix=/usr --root=AppDir -r ./requirements.txt

    - name: install python PyQt6
      working-directory: ${{github.workspace}}
      run : python3 -m pip install --prefix=/usr --root=AppDir PyQt6


    - name: Build AppImage
      uses: AppImageCrafters/build-appimage-action@master
      env:
        UPDATE_INFO: gh-releases-zsync|cgspeck|brewtarget|latest|*x86_64.AppImage.zsync
      with:
        recipe: build-scripts/AppImageBuilder.yml     
    
    - uses: actions/upload-artifact@v4
      with:
        name: LIT
        path: './*.AppImage*'
    
    - uses: xresloader/upload-to-github-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.LAUT_UPLOAD_TOKEN }}
      with:
        file: './*.AppImage*'
        tags: true
        draft: false        